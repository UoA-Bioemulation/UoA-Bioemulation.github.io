<div class="text-center margin-bottom-md">
    <h2>Biological Modelling</h2>
</div>

<h3 class="padding-top-sm">Action Potentials of the Cardiac Cell</h3>
<div class="inline-picture picture-right forced">
    <div class="panel panel-default no-margin-bottom">
        <div class="panel-body padding-xs">
            <div id="ap_chart">
                <div style="padding-top: 30px; padding-bottom: 30px;">
                    <div class="sk-folding-cube">
                        <div class="sk-cube1 sk-cube"></div>
                        <div class="sk-cube2 sk-cube"></div>
                        <div class="sk-cube4 sk-cube"></div>
                        <div class="sk-cube3 sk-cube"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<p>
    An electrical signal driving heart contraction is generated by the transfer of ions across the cells membrane.
    This change in voltage is described as an Action Potential (AP).
    The figure to the right shows the five stages of the AP.

    <ol>
        <li><span style="color: #0288D1;"><strong>Resting Period (RP)</strong></span>: the cell is inactive and is awaiting external stimulus.</li>
        <li><span style="color: #D32F2F;"><strong>Stimulated (ST)</strong></span>: the cell is excited as the external stimulus is above a threshold voltage (<em>v<sub>T</sub></em>).</li>
        <li><span style="color: #F57C00;"><strong>Upstroke (UP)</strong></span>: the cell allows ions to move rapidly until cell's overshoot voltage has been reached (<em>v<sub>O</sub></em>).</li>
        <li>
            <span style="color: #388E3C;"><strong>Effective Refractory Period (ERP)</strong></span>: the cell cannot be activated again due to the recovery process of the ionic channels.
            Here, any new stimulus will be rejected.
            As the cell returns to RP, some of the ionic channels recover faster than others.
        </li>
        <li><span style="color: #512DA8;"><strong>Relative Refractory Period (RRP)</strong></span>: it possible for the cell to get re-excited enabling the potential for secondary excitation.</li>
    </ol>
</p>


<h3 class="padding-top-sm">The UoA Hybrid Automata Cardiac Cell Model</h3>
<div class="inline-picture picture-right">
    <img src="/img/projects/modelling/uoa_ha.png" />
</div>
<p>
    The diagram to the right presents the cell model described using a Hybrid Automata (HA).
    The five stages of AP, explained above, are captured using four locations in the HA.
    The changes in the AP are captured with three Ordinary Differential Equations (ODEs), which are used to evolve three variables: <em>v<sub>x</sub></em>, <em>v<sub>y</sub></em>, and <em>v<sub>z</sub></em> in each location of the HA.
    The overall voltage of the AP is aggregated into a single variable <em>v</em> using <em>v = v<sub>x</sub> &minus; v<sub>y</sub> + v<sub>z</sub></em>.
</p>
<p>
    The voltage of each cell also affects its neighbouring cell voltages.
    This is captured by the aggregation function <span style="white-space: nowrap;"><em>g(<b>v<sub>I</sub></b>) = &Sigma;<sup>|I|</sup><sub>i=1, i &ne; k</sub> v<sub>i</sub>(t &minus; &Delta;<sub>ki</sub>) &times; a<sub>ki</sub> &minus; v<sub>k</sub> &times; d<sub>k</sub></em></span>, where <em><b>v<sub>I</sub></b></em> represents the <em>vector</em> of input voltages from the neighbouring cells, <em>a<sub>ki</sub></em> is the gain applied to the voltage <em>v<sub>i</sub></em> from cell <em>i</em>, <em>&Delta;<sub>ki</sub></em> is the time it takes for the voltage to reach cell <em>k</em>, and <em>d<sub>k</sub></em> is the distance coefficient dependent upon the conduction pathway and the associated propagation delay.
    Constants <em>C<sub>1</sub></em> to <em>C<sub>15</sub></em> are parametrised based on the location of the cell.
</p>
<p>
    The dynamic response of the action potential to secondary excitation is captured by the variable <em>&theta;</em>.
    The value of <em>&theta;</em> affects the overshoot voltage, which is captured by the invariant (<em>v &lt; V<sub>O</sub> &minus; 80.1 &radic;&theta;</em>) of the location UP.
    It is also used to compute the function <em>f(&theta;)</em>, which is a non-linear exponential function that affects the ODEs in location ERP.
    The HA starts execution from the location marked as initial.
    The ODEs in the location are used to evolve the three constituents of the AP until the invariant on the location holds.
    As soon as the invariant is violated, an <em>instantaneous</em> transition is made to the next location.
</p>

<script type="text/javascript">
if ((typeof google === 'undefined') || (typeof google.visualization === 'undefined')) {
    google.charts.load('current', {packages: ['corechart']});
}

google.charts.setOnLoadCallback(drawAPGraph);

function drawAPGraph() {
    var data = new google.visualization.DataTable();
    data.addColumn('number', 'Time');
    data.addColumn('number', 'RP');
    data.addColumn('number', 'ST');
    data.addColumn('number', 'UP');
    data.addColumn('number', 'ERP');
    data.addColumn('number', 'RRP');

    data.addRows([
        [  0,    0,  null,   null,   null,  null], [  1,    0,  null,   null,   null,  null], [  2,    0,  null,   null,   null,  null],
        [  3,    0,  null,   null,   null,  null], [  4,    0,  null,   null,   null,  null], [  5,    0,  null,   null,   null,  null],
        [  6,    0,  null,   null,   null,  null], [  7,    0,  null,   null,   null,  null], [  8,    0,  null,   null,   null,  null],
        [  9,    0,  null,   null,   null,  null], [ 10,    0,  null,   null,   null,  null], [ 11,    0,  null,   null,   null,  null],
        [ 12,    0,  null,   null,   null,  null], [ 13,    0,  null,   null,   null,  null], [ 14,    0,  null,   null,   null,  null],
        [ 15,    0,  null,   null,   null,  null], [ 16,    0,  null,   null,   null,  null], [ 17,    0,  null,   null,   null,  null],
        [ 18,    0,  null,   null,   null,  null], [ 19,    0,  null,   null,   null,  null], [ 20,    0,  null,   null,   null,  null],
        [ 21,    0,  null,   null,   null,  null], [ 22,    0,  null,   null,   null,  null], [ 23,    0,  null,   null,   null,  null],
        [ 24,    0,  null,   null,   null,  null], [ 25,    0,  null,   null,   null,  null], [ 26,    0,  null,   null,   null,  null],
        [ 27,    0,  null,   null,   null,  null], [ 28,    0,  null,   null,   null,  null], [ 29,    0,  null,   null,   null,  null],
        [ 30,    0,  null,   null,   null,  null], [ 31,    0,  null,   null,   null,  null], [ 32,    0,  null,   null,   null,  null],
        [ 33,    0,  null,   null,   null,  null], [ 34,    0,  null,   null,   null,  null], [ 35,    0,  null,   null,   null,  null],
        [ 36,    0,  null,   null,   null,  null], [ 37,    0,  null,   null,   null,  null], [ 38,    0,  null,   null,   null,  null],
        [ 39,    0,  null,   null,   null,  null], [ 40,    0,  null,   null,   null,  null], [ 41,    0,  null,   null,   null,  null],
        [ 42,    0,  null,   null,   null,  null], [ 43,    0,  null,   null,   null,  null], [ 44,    0,  null,   null,   null,  null],
        [ 45,    0,     0,   null,   null,  null], [ 46, null,  19.9,   null,   null,  null], [ 47, null, 29.49,   null,   null,  null],
        [ 48, null, 35.88,   null,   null,  null], [ 49, null, 40.66,   null,   null,  null], [ 50, null,  44.5,   44.5,   null,  null],
        [ 51, null,  null, 130.58, 130.58,  null], [ 52, null,  null,   null, 129.62,  null], [ 53, null,  null,   null,  128.7,  null],
        [ 54, null,  null,   null, 127.81,  null], [ 55, null,  null,   null, 126.95,  null], [ 56, null,  null,   null, 126.12,  null],
        [ 57, null,  null,   null, 125.33,  null], [ 58, null,  null,   null, 124.56,  null], [ 59, null,  null,   null, 123.83,  null],
        [ 60, null,  null,   null, 123.12,  null], [ 61, null,  null,   null, 122.43,  null], [ 62, null,  null,   null, 121.78,  null],
        [ 63, null,  null,   null, 121.14,  null], [ 64, null,  null,   null, 120.54,  null], [ 65, null,  null,   null, 119.95,  null],
        [ 66, null,  null,   null, 119.39,  null], [ 67, null,  null,   null, 118.85,  null], [ 68, null,  null,   null, 118.32,  null],
        [ 69, null,  null,   null, 117.82,  null], [ 70, null,  null,   null, 117.34,  null], [ 71, null,  null,   null, 116.88,  null],
        [ 72, null,  null,   null, 116.43,  null], [ 73, null,  null,   null,    116,  null], [ 74, null,  null,   null, 115.59,  null],
        [ 75, null,  null,   null,  115.2,  null], [ 76, null,  null,   null, 114.82,  null], [ 77, null,  null,   null, 114.45,  null],
        [ 78, null,  null,   null,  114.1,  null], [ 79, null,  null,   null, 113.76,  null], [ 80, null,  null,   null, 113.44,  null],
        [ 81, null,  null,   null, 113.13,  null], [ 82, null,  null,   null, 112.83,  null], [ 83, null,  null,   null, 112.54,  null],
        [ 84, null,  null,   null, 112.27,  null], [ 85, null,  null,   null,    112,  null], [ 86, null,  null,   null, 111.75,  null],
        [ 87, null,  null,   null,  111.5,  null], [ 88, null,  null,   null, 111.27,  null], [ 89, null,  null,   null, 111.04,  null],
        [ 90, null,  null,   null, 110.82,  null], [ 91, null,  null,   null, 110.61,  null], [ 92, null,  null,   null, 110.41,  null],
        [ 93, null,  null,   null, 110.22,  null], [ 94, null,  null,   null, 110.03,  null], [ 95, null,  null,   null, 109.85,  null],
        [ 96, null,  null,   null, 109.68,  null], [ 97, null,  null,   null, 109.51,  null], [ 98, null,  null,   null, 109.35,  null],
        [ 99, null,  null,   null,  109.2,  null], [100, null,  null,   null, 109.05,  null], [101, null,  null,   null,  108.9,  null],
        [102, null,  null,   null, 108.76,  null], [103, null,  null,   null, 108.63,  null], [104, null,  null,   null, 108.49,  null],
        [105, null,  null,   null, 108.37,  null], [106, null,  null,   null, 108.24,  null], [107, null,  null,   null, 108.12,  null],
        [108, null,  null,   null,    108,  null], [109, null,  null,   null, 107.89,  null], [110, null,  null,   null, 107.78,  null],
        [111, null,  null,   null, 107.67,  null], [112, null,  null,   null, 107.56,  null], [113, null,  null,   null, 107.45,  null],
        [114, null,  null,   null, 107.35,  null], [115, null,  null,   null, 107.24,  null], [116, null,  null,   null, 107.14,  null],
        [117, null,  null,   null, 107.04,  null], [118, null,  null,   null, 106.94,  null], [119, null,  null,   null, 106.84,  null],
        [120, null,  null,   null, 106.74,  null], [121, null,  null,   null, 106.64,  null], [122, null,  null,   null, 106.54,  null],
        [123, null,  null,   null, 106.44,  null], [124, null,  null,   null, 106.34,  null], [125, null,  null,   null, 106.24,  null],
        [126, null,  null,   null, 106.13,  null], [127, null,  null,   null, 106.03,  null], [128, null,  null,   null, 105.93,  null],
        [129, null,  null,   null, 105.82,  null], [130, null,  null,   null, 105.71,  null], [131, null,  null,   null,  105.6,  null],
        [132, null,  null,   null, 105.49,  null], [133, null,  null,   null, 105.38,  null], [134, null,  null,   null, 105.26,  null],
        [135, null,  null,   null, 105.14,  null], [136, null,  null,   null, 105.02,  null], [137, null,  null,   null, 104.89,  null],
        [138, null,  null,   null, 104.76,  null], [139, null,  null,   null, 104.63,  null], [140, null,  null,   null,  104.5,  null],
        [141, null,  null,   null, 104.36,  null], [142, null,  null,   null, 104.21,  null], [143, null,  null,   null, 104.07,  null],
        [144, null,  null,   null, 103.91,  null], [145, null,  null,   null, 103.76,  null], [146, null,  null,   null,  103.6,  null],
        [147, null,  null,   null, 103.43,  null], [148, null,  null,   null, 103.26,  null], [149, null,  null,   null, 103.08,  null],
        [150, null,  null,   null,  102.9,  null], [151, null,  null,   null, 102.71,  null], [152, null,  null,   null, 102.52,  null],
        [153, null,  null,   null, 102.32,  null], [154, null,  null,   null, 102.12,  null], [155, null,  null,   null,  101.9,  null],
        [156, null,  null,   null, 101.68,  null], [157, null,  null,   null, 101.46,  null], [158, null,  null,   null, 101.23,  null],
        [159, null,  null,   null, 100.99,  null], [160, null,  null,   null, 100.74,  null], [161, null,  null,   null, 100.48,  null],
        [162, null,  null,   null, 100.22,  null], [163, null,  null,   null,  99.95,  null], [164, null,  null,   null,  99.67,  null],
        [165, null,  null,   null,  99.38,  null], [166, null,  null,   null,  99.08,  null], [167, null,  null,   null,  98.78,  null],
        [168, null,  null,   null,  98.46,  null], [169, null,  null,   null,  98.14,  null], [170, null,  null,   null,   97.8,  null],
        [171, null,  null,   null,  97.46,  null], [172, null,  null,   null,   97.1,  null], [173, null,  null,   null,  96.73,  null],
        [174, null,  null,   null,  96.36,  null], [175, null,  null,   null,  95.97,  null], [176, null,  null,   null,  95.57,  null],
        [177, null,  null,   null,  95.16,  null], [178, null,  null,   null,  94.74,  null], [179, null,  null,   null,   94.3,  null],
        [180, null,  null,   null,  93.86,  null], [181, null,  null,   null,   93.4,  null], [182, null,  null,   null,  92.92,  null],
        [183, null,  null,   null,  92.44,  null], [184, null,  null,   null,  91.94,  null], [185, null,  null,   null,  91.42,  null],
        [186, null,  null,   null,   90.9,  null], [187, null,  null,   null,  90.35,  null], [188, null,  null,   null,   89.8,  null],
        [189, null,  null,   null,  89.23,  null], [190, null,  null,   null,  88.64,  null], [191, null,  null,   null,  88.03,  null],
        [192, null,  null,   null,  87.41,  null], [193, null,  null,   null,  86.78,  null], [194, null,  null,   null,  86.13,  null],
        [195, null,  null,   null,  85.45,  null], [196, null,  null,   null,  84.77,  null], [197, null,  null,   null,  84.06,  null],
        [198, null,  null,   null,  83.34,  null], [199, null,  null,   null,  82.59,  null], [200, null,  null,   null,  81.83,  null],
        [201, null,  null,   null,  81.05,  null], [202, null,  null,   null,  80.25,  null], [203, null,  null,   null,  79.42,  null],
        [204, null,  null,   null,  78.58,  null], [205, null,  null,   null,  77.72,  null], [206, null,  null,   null,  76.83,  null],
        [207, null,  null,   null,  75.92,  null], [208, null,  null,   null,  74.99,  null], [209, null,  null,   null,  74.03,  null],
        [210, null,  null,   null,  73.06,  null], [211, null,  null,   null,  72.05,  null], [212, null,  null,   null,  71.03,  null],
        [213, null,  null,   null,  69.97,  null], [214, null,  null,   null,   68.9,  null], [215, null,  null,   null,  67.79,  null],
        [216, null,  null,   null,  66.66,  null], [217, null,  null,   null,   65.5,  null], [218, null,  null,   null,  64.32,  null],
        [219, null,  null,   null,   63.1,  null], [220, null,  null,   null,  61.86,  null], [221, null,  null,   null,  60.59,  null],
        [222, null,  null,   null,  59.28,  null], [223, null,  null,   null,  57.95,  null], [224, null,  null,   null,  56.58,  null],
        [225, null,  null,   null,  55.18,  null], [226, null,  null,   null,  53.75,  null], [227, null,  null,   null,  52.29,  null],
        [228, null,  null,   null,  50.79,  null], [229, null,  null,   null,  49.26,  null], [230, null,  null,   null,  47.69,  null],
        [231, null,  null,   null,  46.08,  null], [232, null,  null,   null,  44.44,  null], [233, null,  null,   null,  42.76,  null],
        [234, null,  null,   null,  41.04,  null], [235, null,  null,   null,  39.29,  null], [236, null,  null,   null,  37.49,  null],
        [237, null,  null,   null,  35.65,  null], [238, null,  null,   null,  33.77,  null], [239, null,  null,   null,  31.84,  null],
        [240, null,  null,   null,  29.72, 29.72], [241, null,  null,   null,   null, 24.62], [242, null,  null,   null,   null,  20.4],
        [243, null,  null,   null,   null,  16.9], [244, null,  null,   null,   null, 14.01], [245, null,  null,   null,   null, 11.61],
        [246, null,  null,   null,   null,  9.62], [247, null,  null,   null,   null,  7.98], [248, null,  null,   null,   null,  6.62],
        [249, null,  null,   null,   null,  5.49], [250, null,  null,   null,   null,  4.56], [251, null,  null,   null,   null,  3.78],
        [252, null,  null,   null,   null,  3.14], [253, null,  null,   null,   null,  2.61], [254, null,  null,   null,   null,  2.17],
        [255, null,  null,   null,   null,  1.81], [256, null,  null,   null,   null,  1.51], [257, null,  null,   null,   null,  1.26],
        [258, null,  null,   null,   null,  1.05], [259, null,  null,   null,   null,  0.88], [260, null,  null,   null,   null,  0.74],
        [261, null,  null,   null,   null,  0.62], [262, null,  null,   null,   null,  0.52], [263, null,  null,   null,   null,  0.44],
        [264, null,  null,   null,   null,  0.38], [265, null,  null,   null,   null,  0.32], [266, null,  null,   null,   null,  0.27],
        [267, null,  null,   null,   null,  0.24], [268, null,  null,   null,   null,   0.2], [269, null,  null,   null,   null,  0.18],
        [270, null,  null,   null,   null,  0.16], [271, null,  null,   null,   null,  0.14], [272, null,  null,   null,   null,  0.12],
        [273, null,  null,   null,   null,  0.11], [274, null,  null,   null,   null,   0.1], [275, null,  null,   null,   null,  0.09],
        [276, null,  null,   null,   null,  0.08], [277, null,  null,   null,   null,  0.08], [278, null,  null,   null,   null,  0.07],
        [279, null,  null,   null,   null,  0.07], [280, null,  null,   null,   null,  0.06], [281, null,  null,   null,   null,  0.06],
        [282, null,  null,   null,   null,  0.06], [283, null,  null,   null,   null,  0.06], [284, null,  null,   null,   null,  0.05],
        [285, null,  null,   null,   null,  0.05], [286, 0.05,  null,   null,   null,  0.05], [287, 0.05,  null,   null,   null,  null],
        [288, 0.05,  null,   null,   null,  null], [289, 0.05,  null,   null,   null,  null], [290, 0.05,  null,   null,   null,  null],
        [291, 0.05,  null,   null,   null,  null], [292, 0.05,  null,   null,   null,  null], [293, 0.04,  null,   null,   null,  null],
        [294, 0.04,  null,   null,   null,  null], [295, 0.04,  null,   null,   null,  null], [296, 0.04,  null,   null,   null,  null],
        [297, 0.04,  null,   null,   null,  null], [298, 0.04,  null,   null,   null,  null], [299, 0.04,  null,   null,   null,  null],
        [300, 0.04,  null,   null,   null,  null]
    ]);

    var options = {
        title: 'Cardiac Action Potential',
        height: 200,
        series: {
            0: { color: '#0288D1' },
            1: { color: '#D32F2F' },
            2: { color: '#F57C00' },
            3: { color: '#388E3C' },
            4: { color: '#512DA8' }
        },
        hAxis: {
            title: 'Time (ms)'
        },
        vAxis: {
            title: 'Potential (mV)',
            viewWindowMode: 'explicit',
            viewWindow: {
                max: 140,
                min: 0
            }
        },
		chartArea: {
			left: '15%',
			width: '80%'
		},
        legend: {
            position: 'none'
        }
    };

    var chart = new google.visualization.LineChart(document.getElementById('ap_chart'));
    chart.draw(data, options);
}

</script>
